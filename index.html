<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>關於我們 - 東吳大學學生會</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="favicon.PNG" type="image/x-icon">
    <style>
        /* 預設連結樣式 */
        a {
            color: rgb(255, 233, 109);
            text-decoration: none;
        }

        /* 滑鼠懸停時的樣式 */
        a:hover {
            color: rgb(255, 255, 255);
            text-decoration: underline;
        }

        .edit-mode input, .edit-mode textarea {
            width: 100%;
            margin-bottom: 10px;
        }

        .edit-mode button {
            margin-top: 10px;
        }
    </style>
</head>

<body>
    <div class="admin-button-container">
        <a href="login.html" class="admin-button">管理</a>
    </div>

    <div class="container">
        <div class="hamburger-menu" id="hamburger-menu">
            <span></span>
            <span></span>
            <span></span>
        </div>

        <nav class="sidebar" id="sidebar">
            <div class="logo">
                <img src="logo.png" alt="Logo">
                <div class="site-name"></div>
            </div>
            <ul class="nav-links">
                <li><a href="https://linktr.ee/scusa_" target="_blank"><img src="linktree-icon.png" alt="連結樹" /></a></li>
                <li><a href="https://www.facebook.com/SUSAweb/?locale=zh_TW" target="_blank"><img src="facebook-icon.png" alt="臉書" /></a></li>
                <li><a href="https://www.instagram.com/scusa68th/" target="_blank"><img src="instagram-icon.png" alt="Instagram" /></a></li>
                <li class="dropdown-parent">
                    <a href="#" class="dropdown-toggle">海報欄位租借</a>
                    <ul class="dropdown-content">
                        <li><a href="https://docs.google.com/forms/d/1BA6RxfE57eXTvHCHYpx55J5j8F4wpPpaXkV1RwSE-bI/edit?usp=forms_home">雙溪校區</a></li>
                        <li><a href="https://docs.google.com/forms/d/e/1FAIpQLSfLA7QgEmYeEBLxYxqeSj-yorHe_RddVuxxgSWnGQg75zp00w/viewform?usp=sf_link">城中校區</a></li>
                    </ul>
                </li>
            </ul>
        </nav>

        <div class="main-content">
            <div class="dropdown">
                <select id="pages" onchange="location = this.value;">
                    <option value="index.html" selected>首頁</option>
                    <option value="about.html">關於我們</option>
                    <option value="shop.html">特約商店</option>
                </select>
            </div>

            <div class="announcements">
                <div id="announcements-list">
                    <div class="announcement" id="announcement1">
                        <h2 contenteditable="false" class="title">公告標題</h2>
                        <p contenteditable="false" class="message">公告訊息</p>
                        <a href="#" contenteditable="false" class="link">超連結</a>
                    </div>
                </div>

                <button id="add-announcement-btn" style="display:none;" onclick="addAnnouncement()">新增公告</button>
                <button id="save-announcement-btn" style="display:none;" onclick="saveAnnouncements()">保存</button>
            </div>
        </div>
    </div>

    <script src="app.js"></script> <!-- 確保在 DOM 加載後引用 -->
    <script>
        const hamburgerMenu = document.getElementById('hamburger-menu');
        const sidebar = document.getElementById('sidebar');

        hamburgerMenu.addEventListener('click', function() {
            sidebar.classList.toggle('active');
            if (sidebar.classList.contains('active')) {
                document.querySelector('.main-content').style.marginLeft = '200px';
            } else {
                document.querySelector('.main-content').style.marginLeft = '0';
            }
        });

        document.addEventListener('DOMContentLoaded', function() {
            const dropdownParent = document.querySelector('.dropdown-parent');
            const dropdownToggle = dropdownParent.querySelector('.dropdown-toggle');
            const dropdownContent = dropdownParent.querySelector('.dropdown-content');
            
            dropdownToggle.addEventListener('click', function() {
                dropdownParent.classList.toggle('active');
            });

            const loggedIn = localStorage.getItem('loggedIn');
            if (loggedIn === 'true') {
                enableEditing();
            }

            loadAnnouncements();
        });

        function enableEditing() {
            document.querySelectorAll('.announcement h2, .announcement p, .announcement a').forEach(el => {
                el.contentEditable = "true";
                el.classList.add('edit-mode');
            });

            document.getElementById('add-announcement-btn').style.display = 'block'; // 顯示新增公告按鈕
            document.getElementById('save-announcement-btn').style.display = 'block'; // 顯示保存按鈕
        }

        function addAnnouncement() {
            const newAnnouncement = document.createElement('div');
            newAnnouncement.classList.add('announcement');
            newAnnouncement.innerHTML = `
                <h2 contenteditable="true" class="title">新公告標題</h2>
                <p contenteditable="true" class="message">新公告內容</p>
                <a href="#" contenteditable="true" class="link">超連結</a>
            `;
            document.getElementById('announcements-list').appendChild(newAnnouncement);
        }

        function saveAnnouncements() {
            const titles = document.querySelectorAll('.title');
            const messages = document.querySelectorAll('.message');
            const links = document.querySelectorAll('.link');

            const announcements = [];

            titles.forEach((title, index) => {
                announcements.push({
                    title: title.innerText,
                    message: messages[index].innerText,
                    link: links[index].innerText
                });
            });

            console.log('要保存的公告:', announcements); // 日誌記錄

            // 使用 AJAX 發送公告內容到伺服器
            fetch('save_announcement.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ announcements })
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    alert('公告已保存！');
                } else {
                    alert('保存失敗，請稍後再試。');
                }
            })
            .catch(error => console.error('Error:', error));
        }

        function loadAnnouncements() {
            const savedAnnouncements = localStorage.getItem('announcements');
            if (savedAnnouncements) {
                const announcementData = JSON.parse(savedAnnouncements);
                const announcementList = document.getElementById('announcements-list');
                announcementList.innerHTML = ''; // 清空公告欄

                announcementData.forEach((data) => {
                    const newAnnouncement = document.createElement('div');
                    newAnnouncement.classList.add('announcement');
                    newAnnouncement.innerHTML = `
                        <h2 contenteditable="false" class="title">${data.title}</h2>
                        <p contenteditable="false" class="message">${data.message}</p>
                        <a href="#" contenteditable="false" class="link">${data.link}</a>
                    `;
                    announcementList.appendChild(newAnnouncement);
                });
            }
        }
    </script>
</body>
</html>
