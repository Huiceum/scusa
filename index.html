<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>關於我們 - 東吳大學學生會</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="favicon.PNG" type="image/x-icon">

    <style>
        /* 預設連結樣式 */
        a {
            color: rgb(255, 233, 109);
            text-decoration: none;
        }

        /* 滑鼠懸停時的樣式 */
        a:hover {
            color: rgb(255, 255, 255);
            text-decoration: underline;
        }

        .edit-mode input, .edit-mode textarea {
            width: 100%;
            margin-bottom: 10px;
        }

        .edit-mode button {
            margin-top: 10px;
        }
    </style>
</head>

<body>
    <div class="admin-button-container">
        <a href="login.html" class="admin-button">管理</a>
    </div>

    <div class="container">
        <!-- 漢堡選單按鈕 -->
        <div class="hamburger-menu" id="hamburger-menu">
            <span></span>
            <span></span>
            <span></span>
        </div>

        <nav class="sidebar" id="sidebar">
            <div class="logo">
                <img src="logo.png" alt="Logo">
                <div class="site-name"></div>
            </div>
            <ul class="nav-links">
                <li><a href="https://linktr.ee/scusa_" target="_blank"><img src="linktree-icon.png" alt="連結樹" /></a></li>
                <li><a href="https://www.facebook.com/SUSAweb/?locale=zh_TW" target="_blank"><img src="facebook-icon.png" alt="臉書" /></a></li>
                <li><a href="https://www.instagram.com/scusa68th/" target="_blank"><img src="instagram-icon.png" alt="Instagram" /></a></li>
        
                <!-- 新增下滑式選項 -->
                <li class="dropdown-parent">
                    <a href="#" class="dropdown-toggle">海報欄位租借</a>
                    <ul class="dropdown-content">
                        <li><a href="https://docs.google.com/forms/d/1BA6RxfE57eXTvHCHYpx55J5j8F4wpPpaXkV1RwSE-bI/edit?usp=forms_home">雙溪校區</a></li>
                        <li><a href="https://docs.google.com/forms/d/e/1FAIpQLSfLA7QgEmYeEBLxYxqeSj-yorHe_RddVuxxgSWnGQg75zp00w/viewform?usp=sf_link">城中校區</a></li>
                    </ul>
                </li>
            </ul>
        </nav>

        <div class="main-content">
            <div class="dropdown">
                <select id="pages" onchange="location = this.value;">
                    <option value="index.html" selected>首頁</option>
                    <option value="about.html">關於我們</option>
                    <option value="shop.html">特約商店</option>
                </select>
            </div>

            <div class="announcements">
                <div id="announcements-list">
                    <!-- 公告內容 -->
                    <div class="announcement" id="announcement1">
                        <h2 contenteditable="false" class="title">公告標題</h2>
                        <p contenteditable="false" class="message">公告訊息</p>
                        <a href="#" contenteditable="false" class="link">超連結</a>
                    </div>
                </div>

                <!-- 新增公告按鈕及保存按鈕，僅限登入後可見 -->
                <button id="add-announcement-btn" style="display:none;" onclick="addAnnouncement()">新增公告</button>
                <button id="save-announcement-btn" style="display:none;" onclick="saveAnnouncements()">保存</button>
                <button class="delete-announcement-btn" onclick="deleteAnnouncement(this)">刪除公告</button>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        const hamburgerMenu = document.getElementById('hamburger-menu');
        const sidebar = document.getElementById('sidebar');
    
        hamburgerMenu.addEventListener('click', function() {
            sidebar.classList.toggle('active');
    
            // 根據側邊欄的顯示或隱藏狀態調整主要內容位置
            if (sidebar.classList.contains('active')) {
                document.querySelector('.main-content').style.marginLeft = '200px';
            } else {
                document.querySelector('.main-content').style.marginLeft = '0';
            }
        });
    
        document.addEventListener('DOMContentLoaded', function() {
            const dropdownParent = document.querySelector('.dropdown-parent');
            const dropdownToggle = dropdownParent.querySelector('.dropdown-toggle');
            const dropdownContent = dropdownParent.querySelector('.dropdown-content');
    
            dropdownToggle.addEventListener('click', function() {
                dropdownParent.classList.toggle('active');
            });
    
            // 檢查是否已登入
            const loggedIn = localStorage.getItem('loggedIn');
            if (loggedIn === 'true') {
                enableEditing();
            }
    
            loadAnnouncements();
        });
    
        function enableEditing() {
            // 允許編輯公告標題、內文、超連結
            document.querySelectorAll('.announcement h2, .announcement p, .announcement a').forEach(el => {
                el.contentEditable = "true";
                el.classList.add('edit-mode');
            });
    
            document.getElementById('add-announcement-btn').style.display = 'block'; // 顯示新增公告按鈕
            document.getElementById('save-announcement-btn').style.display = 'block'; // 顯示保存按鈕
        }
    
        function addAnnouncement() {
            // 創建新的公告欄位
            const newAnnouncement = document.createElement('div');
            newAnnouncement.classList.add('announcement');
    
            newAnnouncement.innerHTML = `
                <h2 contenteditable="true" class="title">新公告標題</h2>
                <p contenteditable="true" class="message">新公告內容</p>
                <a href="#" contenteditable="true" class="link">超連結</a>
            `;
    
            document.getElementById('announcements-list').appendChild(newAnnouncement);
        }
    
        function saveAnnouncements() {
            const announcements = document.querySelectorAll('.announcement');
    const announcementData = [];

    announcements.forEach((announcement) => {
        const title = announcement.querySelector('.title').innerText;
        const message = announcement.querySelector('.message').innerText;
        const link = announcement.querySelector('.link').innerText;

        announcementData.push({
            title,
            message,
            link
        });
    });

    // 將公告資料發送到伺服器
    fetch('/api/announcements', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(announcementData),
    })
    .then(response => {
        if (response.ok) {
            alert('公告已保存');
        } else {
            alert('保存公告時出錯');
        }
    })
    .catch(error => {
        console.error('Error:', error);
    });
}

function loadAnnouncements() {
    fetch('/api/announcements')
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.json();
    })
    .then(announcementData => {
        const announcementList = document.getElementById('announcements-list');
        announcementList.innerHTML = ''; // 清空公告欄

        announcementData.forEach((data) => {
            const newAnnouncement = document.createElement('div');
            newAnnouncement.classList.add('announcement');

            newAnnouncement.innerHTML = `
                <h2 contenteditable="false" class="title">${data.title}</h2>
                <p contenteditable="false" class="message">${data.message}</p>
                <a href="#" contenteditable="false" class="link">${data.link}</a>
            `;

            announcementList.appendChild(newAnnouncement);
        });
    })
    .catch(error => {
        console.error('Error loading announcements:', error);
    });
}
    
        function loadAnnouncements() {
            const savedAnnouncements = localStorage.getItem('announcements');
            if (savedAnnouncements) {
                const announcementData = JSON.parse(savedAnnouncements);
                const announcementList = document.getElementById('announcements-list');
                announcementList.innerHTML = ''; // 清空公告欄
    
                announcementData.forEach((data) => {
                    const newAnnouncement = document.createElement('div');
                    newAnnouncement.classList.add('announcement');
    
                    newAnnouncement.innerHTML = `
                        <h2 contenteditable="false" class="title">${data.title}</h2>
                        <p contenteditable="false" class="message">${data.message}</p>
                        <a href="#" contenteditable="false" class="link">${data.link}</a>
                    `;
    
                    announcementList.appendChild(newAnnouncement);
                });
            }
        }
    
        // 新增刪除最後一則公告的函數
        function deleteLastAnnouncement() {
            const announcements = document.querySelectorAll('.announcement'); // 假設公告的 class 是 'announcement'
            if (announcements.length > 0) {
                const lastAnnouncement = announcements[announcements.length - 1]; // 取得最後一則公告
                lastAnnouncement.remove(); // 刪除最後一則公告
            }
        }
    
        // 事件監聽器
        document.querySelector('.delete-announcement-btn').addEventListener('click', deleteLastAnnouncement);
    </script>
    
</body>
</html>
