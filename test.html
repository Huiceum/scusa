<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>雙頁電子書翻頁效果</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.3.122/pdf.min.js"></script>
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }
        #pdf-container {
            display: flex;
            justify-content: center;
            align-items: center;
            background: #fff;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
            width: 90%;
            max-width: 1000px;
        }
        canvas {
            border: 1px solid #ddd;
            margin: 0 2px;
            transition: transform 0.7s ease;
            width: 45%;
            height: auto;
        }
        .fade-out-right {
            transform: translateX(-100%);
        }
        .fade-in-right {
            transform: translateX(0);
        }
        .controls {
            text-align: center;
            margin-top: 10px;
        }
        button, input {
            margin: 5px;
            padding: 10px 15px;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button {
            background-color: #007bff;
            color: white;
        }
        button:hover {
            background-color: #0056b3;
        }
        input[type="number"] {
            width: 60px;
            text-align: center;
        }
    </style>
</head>
<body>

<div id="pdf-container">
    <canvas id="pdf-canvas-left"></canvas>
    <canvas id="pdf-canvas-right"></canvas>
</div>
<div class="controls">
    <button onclick="prevPage()">上一頁</button>
    <input type="number" id="goto-page" min="1" onchange="gotoPage()">
    <button onclick="nextPage()">下一頁</button>
</div>

<script>
    let url = '東吳大學學生自治法規錄.pdf';  // 替換為你的 PDF 檔案路徑
    let pdfDoc = null,
        pageNum = 1,
        pageRendering = false,
        scale = 2,  // 提高解析度
        fixedWidth = 400,  // 固定寬度
        canvasLeft = document.getElementById('pdf-canvas-left'),
        canvasRight = document.getElementById('pdf-canvas-right'),
        ctxLeft = canvasLeft.getContext('2d'),
        ctxRight = canvasRight.getContext('2d');

    pdfjsLib.getDocument(url).promise.then(function(pdf) {
        pdfDoc = pdf;
        document.getElementById('goto-page').value = pageNum;
        renderPage(pageNum);
    });

    function renderPage(num) {
        pageRendering = true;
        canvasLeft.classList.add('fade-out-right');
        canvasRight.classList.add('fade-out-right');

        setTimeout(() => {
            let renderLeft = num;
            let renderRight = num + 1 <= pdfDoc.numPages ? num + 1 : num;

            pdfDoc.getPage(renderLeft).then(function(page) {
                let viewport = page.getViewport({ scale: scale });
                let aspectRatio = viewport.height / viewport.width;
                canvasLeft.width = fixedWidth;
                canvasLeft.height = fixedWidth * aspectRatio;

                let renderContext = {
                    canvasContext: ctxLeft,
                    viewport: page.getViewport({ width: fixedWidth })
                };
                page.render(renderContext).promise.then(() => {
                    canvasLeft.classList.remove('fade-out-right');
                    canvasLeft.classList.add('fade-in-right');
                });
            });

            pdfDoc.getPage(renderRight).then(function(page) {
                let viewport = page.getViewport({ scale: scale });
                let aspectRatio = viewport.height / viewport.width;
                canvasRight.width = fixedWidth;
                canvasRight.height = fixedWidth * aspectRatio;

                let renderContext = {
                    canvasContext: ctxRight,
                    viewport: page.getViewport({ width: fixedWidth })
                };
                page.render(renderContext).promise.then(() => {
                    canvasRight.classList.remove('fade-out-right');
                    canvasRight.classList.add('fade-in-right');
                    pageRendering = false;
                });
            });
        }, 300);
    }

    function prevPage() {
        if (pageNum <= 1) return;
        pageNum -= 2;
        if (pageNum < 1) pageNum = 1;
        renderPage(pageNum);
        document.getElementById('goto-page').value = pageNum;
    }

    function nextPage() {
        if (pageNum + 2 > pdfDoc.numPages) return;
        pageNum += 2;
        renderPage(pageNum);
        document.getElementById('goto-page').value = pageNum;
    }

    function gotoPage() {
        let inputPage = parseInt(document.getElementById('goto-page').value);
        if (inputPage >= 1 && inputPage <= pdfDoc.numPages) {
            pageNum = inputPage % 2 === 0 ? inputPage - 1 : inputPage;
            renderPage(pageNum);
        } else {
            alert('頁數超出範圍');
        }
    }
</script>

</body>
</html>